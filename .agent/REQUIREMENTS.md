# MY_SHOP 요구사항 정의서 (Software Requirements Specification)

본 문서는 `MY_SHOP` 프로젝트의 기능 및 비즈니스 로직에 대한 상세 요구사항을 정의합니다.

---

## 1. 회원 (Member) 도메인

### 1.1 주요 개념
- **Role (권한)**: 시스템 사용자는 3가지 역할을 가짐.
    - `BUYER`: 상품 구매, 주문 조회, 리뷰 작성 가능
    - `SELLER`: 상품 등록/수정, 내 상품의 판매/주문 관리, 정산 조회
    - `ADMIN`: 전체 회원 관리, 카테고리 관리, 전체 통계 확인

### 1.2 기능 요구사항
1. **회원가입**
    - 이메일, 비밀번호, 이름, 휴대폰 번호를 필수로 입력받는다.
    - 판매자(`SELLER`) 가입 시 사업자 등록 번호(선택) 또는 상점명을 추가로 입력받는다.
    - 비밀번호는 암호화하여 저장해야 한다 (BCrypt 등).
2. **로그인/인증**
    - 이메일/비밀번호 기반의 일반 로그인과 OAuth 2.0 (Google, Kakao) 소셜 로그인을 제공한다.
    - **JWT** 발급: Access Token (30분), Refresh Token (2주).
3. **로컬 개발 환경 자동화**
    - H2 인메모리 데이터베이스 사용 시 `init.sql`을 통해 초기 사용자 및 카테고리 데이터를 자동으로 삽입한다.
3. **내 정보 관리**
    - 회원은 자신의 주소지(배송지)를 여러 개 등록 및 관리할 수 있다.

---

## 2. 상품 (Product) 도메인

### 2.1 주요 개념
- **계층 구조**: 상품(Product) -> 옵션 그룹(OptionGroup) -> 옵션 상세(OptionDetail) -> 재고(Stock) 개념 대신, **Product -> Item(구체적인 판매 단위)** 구조를 사용하거나 단순화할 수 있음. 본 프로젝트에서는 **Product(대표 상품) - ProductOption(옵션) - Stock(재고)** 구조를 제안함.

### 2.2 기능 요구사항
1. **상품 등록 (Seller Only)**
    - 상품명, 기본 가격, 설명, 카테고리는 필수값이다.
    - **상품 이미지는 최소 1장(대표 이미지) 이상** 포함되어야 한다.
    - **AI 설명 생성**: 상품명과 키워드를 입력하면 AI(OpenAI)가 마켓용 감성 설명을 자동 생성해주는 기능을 제공한다.
2. **옵션 및 재고 관리**
    - 상품은 단일 상품일 수도 있고, 옵션(색상, 사이즈 등)을 가질 수도 있다.
    - **재고(Stock)**는 각 옵션 조합별로 관리된다. (예: 티셔츠/Red/L = 10개)
    - 재고가 0인 경우 '품절(SOLD_OUT)' 상태로 자동 변경되거나 구매가 불가능해야 한다.
3. **상품 조회**
    - 구매자는 카테고리별, 키워드별 상품을 검색/조회할 수 있다.
    - 최신순, 판매량순, 가격순 정렬을 지원한다.

---

## 3. 주문 (Order) 도메인

### 3.1 주요 개념
- **주문 상태 (OrderStatus)**:
    - `PENDING` (결제 대기): 주문 생성 직후
    - `PAYMENT_COMPLETED` (결제 완료): PG사 승인 완료
    - `PREPARING` (배송 준비중): 판매자가 주문 확인
    - `SHIPPING` (배송중): 운송장 번호 입력 완료
    - `DELIVERED` (배송 완료): 구매자 수령 확인
    - `CANCELLED` (취소): 배송 전 취소
    - `RETURNED` (반품): 배송 후 반품

### 3.2 기능 요구사항
1. **장바구니 (Cart)**
    - 구매자는 상품(옵션 포함)과 수량을 장바구니에 담을 수 있다.
    - 장바구니에 담을 때 현재 재고를 초과할 수 없다.
2. **주문 생성 (Place Order)**
    - **필수 조건**: 주문은 **최소 1개 이상의 상품(OrderLineItem)**을 포함해야 한다.
    - **재고 차감**: 주문 생성(또는 결제 진입) 시점에 재고를 차감(lock)하거나, 결제 승인 시점에 차감한다. (동시성 문제 해결 필요: `Pessimistic Lock` or `Redisson`)
    - 배송지 정보와 결제 수단을 선택하여 주문서(Order Sheet)를 생성한다.
3. **주문 취소**
    - `SHIPPING` 단계 이전(`PENDING`, `PAYMENT_COMPLETED`, `PREPARING`)까지만 즉시 취소가 가능하다.
    - 결제 완료 후 취소 시, 자동 환불 프로세스가 동작해야 한다.

---

## 4. 결제 (Payment) 도메인

### 4.1 기능 요구사항
1. **결제 검증**
    - 프론트엔드에서 PG사 결제 진행 후, **서버 측에서 반드시 결제 금액 위변조 여부를 검증**해야 한다. (주문 금액 == 결제 승인 금액)
2. **결제 이력**
    - 결제 성공/실패 이력을 모두 저장해야 한다.
3. **정산 (Settlement)**
    - 구매 확정(`CONFIRMED`)된 주문 건에 대해 판매자에게 정산 금액을 계산한다.
    - 수수료(예: 3%)를 제외한 금액을 적립 또는 정산 테이블에 기록한다.

---

## 5. 판매자 관리 (Seller Management) 도메인

### 5.1 판매자 대시보드 (Dashboard)
1. **판매 실적 요약**
    - **총 매출/주문**: 해당 마켓의 전체 누적 매출액과 주문 건수를 표시한다.
    - **오늘의 실적**: 당일(00:00:00 ~ 현재) 발생한 매출액과 주문 건수를 실시간으로 집계한다.
    - **이번 달 실적**: 당월 1일부터 현재까지의 누적 실적을 집계한다.
2. **운영 현황 요약**
    - **미처리 주문**: 현재 `PENDING`(결제 대기) 또는 처리 대기 중인 주문 건수를 표시하여 즉각적인 확인을 돕는다.
    - **등록 상품 현황**: 현재 판매자가 등록하여 관리 중인 총 상품 수를 표시한다.

### 5.2 판매자 주문 관리
1. **최근 주문 조회**
    - 판매자 마켓에서 발생한 최근 주문 내역(최대 10건)을 리스트 형태로 제공한다.
    - 주문 번호, 주문자명, 상품명(외 N개), 총 결제 금액, 주문 상태, 주문 일시 정보를 포함한다.
2. **소유권 검증**
    - 모든 대시보드 및 주문 데이터는 해당 판매자의 마켓에 속한 데이터만 조회 가능하도록 철저히 제한한다.

---

## 6. 비즈니스 규칙 및 제약사항 (Business Rules)

1. **상품 가격 정책**: 상품 가격은 0원 미만일 수 없다. (무료 나눔 제외 시 최소 100원 이상 등의 제약)
2. **주문 수정 불가**: 이미 생성된 주문의 상품 구성은 변경할 수 없다. 변경하려면 주문 전체 취소 후 재주문해야 한다.
3. **리뷰 작성 권한**: 해당 상품을 구매하고 `배송 완료` 상태인 회원만 리뷰를 작성할 수 있다.
4. **회원 탈퇴**: 진행 중인 주문(`SHIPPING` 등)이 있는 경우 탈퇴가 불가능하다.

---

## 7. 개발 우선순위 (Roadmap)

### Phase 1 (MVP)
- 회원가입/로그인 (JWT)
- 상품 등록/조회/수정 (단일 옵션)
- 판매자 전용 상품 관리 시스템 (목록, 상세, 이미지 업로드)
- 주문 생성 및 결제(Mocking)
- 내 주문 내역 확인

### Phase 2 (Seller & Advanced)
- **판매자 대시보드**: 매출/주문 통계 및 운영 현황 요약 API
- **판매자 주문 관리**: 최근 주문 내역 조회 및 상태 관리 기초
- 다중 옵션 및 재고 관리 (복잡도 증가)
- PG사 실제 연동 (Toss Payments 등)
- AI 설명 생성 기능 연동
- 장바구니 기능

### Phase 3 (Operation)
- 정산 시스템
- 배송 추적
- 관리자(ADMIN)용 전체 통계 대시보드
- 고객 센터 (문의/답변)
